<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>InstaCard!</title>
  <link rel="icon" type="image/png" href="favicon.png" />

  <!-- Import Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Pacifico&family=Lobster&family=Indie+Flower&family=Comic+Neue:wght@400;700&family=Great+Vibes&family=Roboto:wght@400;700&family=Open+Sans:wght@400;700&family=Lato:wght@400;700&family=Montserrat:wght@400;700&family=Raleway:wght@400;700&display=swap"
    rel="stylesheet"
  />

  <style>
    /* GLOBAL RESET */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: "Montserrat", sans-serif;
      background-color: #121212;
      color: #eeeeee;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 2rem;
    }
    h1 {
      font-size: 3rem;
      font-weight: 700;
      color: #ffffff;
      margin-bottom: 0.5rem;
      text-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
      text-align: center;
    }
    h6 {
      font-size: 1rem;
      font-weight: 400;
      color: #cccccc;
      margin-bottom: 2rem;
      text-align: center;
    }

    /* ROW CONTAINERS */
    .row {
      display: flex;
      gap: 1rem;
      width: 100%;
      max-width: 800px;
      margin-bottom: 1.5rem;
    }
    .input-row {
      justify-content: flex-start;
      flex-wrap: wrap;
    }
    .input-row input {
      flex: 1;
      min-width: 140px;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      background-color: #1e1e1e;
      color: #ffffff;
      border: 2px solid #555555;
      border-radius: 12px;
      outline: none;
      transition: border-color 0.2s ease;
    }
    .input-row input:focus {
      border-color: #888888;
    }

    .option-row {
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .option-row select,
    .option-row input[type="file"] {
      flex: 0 0 140px;
      padding: 0.75rem 1rem;
      font-size: 1rem;
      background-color: #1e1e1e;
      color: #ffffff;
      border: 2px solid #555555;
      border-radius: 12px;
      outline: none;
      transition: border-color 0.2s ease;
    }
    .option-row select:focus,
    .option-row input[type="file"]:focus {
      border-color: #888888;
    }
    .option-row input[type="color"] {
      flex: 0 0 40px;
      height: 30px;
      padding: 0;
      border: none;
      background: none;
      cursor: pointer;
      border-radius: 8px;
    }
    .ai-btn {
      flex: 0 0 80px;
      padding: 0.75rem;
      font-size: 1rem;
      background-color: #2e2e2e;
      color: #ffffff;
      border: 2px solid #555555;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.2s ease, border-color 0.2s ease;
      text-align: center;
    }
    .ai-btn:hover {
      background-color: #444444;
      border-color: #888888;
    }

    /* DESKTOP CARD + DOWNLOAD (unchanged layout) */
    #card-container {
      width: 500px;
      margin: 1rem auto;
      text-align: center;
    }
    #card-desktop {
      width: 100%;
      height: 340px;
      border-radius: 20px;
      background-color: #ffffff;
      background-size: cover;
      background-position: center;
      position: relative;
      overflow: hidden;
      display: block;
      margin-bottom: 1rem;
    }
    /* Center text inside live preview */
    #card-desktop #card-content-desktop {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center; /* vertical center */
      align-items: center;     /* horizontal center */
      text-align: center;
      padding: 1rem;
      color: inherit; /* ‚Üê was ‚Äú#000000‚Äù before; now inherits from #card-desktop */
    }
    #watermark-desktop {
      position: absolute;
      top: 8px;
      left: 8px;
      font-size: 1.25rem;
      color: rgba(128, 128, 128, 0.5);
      font-weight: 700;
      pointer-events: none;
      user-select: none;
    }
    .btn-container {
      margin-top: 0.5rem;
      text-align: center;
    }
    .btn {
      padding: 0.75rem 2rem;
      font-size: 1.1rem;
      font-weight: 600;
      color: #000000;
      background-color: #ff7f50;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: background 0.4s ease;
    }
    .btn:hover {
      background: linear-gradient(45deg,
        #ffb3ba,
        #ffdfba,
        #ffffba,
        #baffc9,
        #bae1ff,
        #e3baff);
    }

    /* MOBILE-SPECIFIC RULES */
    @media (max-width: 768px) {
      /* Stack inputs full-width */
      .row {
        flex-direction: column;
        align-items: stretch;
      }
      .input-row input,
      .option-row select,
      .option-row input[type="file"],
      .option-row input[type="color"],
      .ai-btn {
        width: 100%;
      }
      .option-row {
        gap: 0.5rem;
      }

      /* Make live preview fit viewport */
      #card-container {
        width: 90%;
      }
      #card-desktop {
        /* Maintain original aspect ratio: 500x340 */
        width: 100%;
        aspect-ratio: 500 / 340;
        height: auto;
        margin-bottom: 1rem;
      }

      /* Ensure the desktop download button is visible and full-width */
      .btn-container {
        margin-bottom: 1rem;
      }
      #downloadBtnDesktop {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <h1>InstaCard</h1>
  <h6>Designing Invitation Cards Simplified.</h6>

  <!-- INPUT SECTION (Visible on both desktop & mobile) -->
  <div id="input-section">
    <div class="row input-row">
      <input type="text" id="eventTitle" placeholder="Event Title ‚ú®" />
      <input type="date" id="date" />
      <input type="time" id="time" />
      <input type="text" id="location" placeholder="Location üìå" />
    </div>

    <div class="row option-row">
      <select id="fontSelector">
        <option value="Pacifico">Pacifico</option>
        <option value="Lobster">Lobster</option>
        <option value="Indie Flower">Indie Flower</option>
        <option value="Comic Neue">Comic Neue</option>
        <option value="Great Vibes">Great Vibes</option>
        <option value="Roboto">Roboto</option>
        <option value="Open Sans">Open Sans</option>
        <option value="Lato">Lato</option>
        <option value="Montserrat" selected>Montserrat</option>
        <option value="Raleway">Raleway</option>
      </select>
      <input type="color" id="textColorPicker" value="#000000" title="Text Color" />
      <input type="file" id="bgUpload" accept="image/*" />
      <input type="color" id="bgColorPicker" value="#ffffff" title="Background Color" />
      <button id="aiBtn" class="ai-btn">AI ‚ú®</button>
    </div>
  </div>

  <!-- LIVE PREVIEW + DOWNLOAD BUTTON (Same for Desktop & Mobile) -->
  <div id="card-container">
    <div id="card-desktop">
      <div id="watermark-desktop">InstaCard</div>
      <div id="card-content-desktop">
        <h2 id="cardTitle-desktop">Event Title</h2>
        <p id="cardDate-desktop">Date: </p>
        <p id="cardTime-desktop">Time: </p>
        <p id="cardLocation-desktop">Location: </p>
      </div>
    </div>
    <div class="btn-container">
      <button id="downloadBtnDesktop" class="btn">Download ‚ú®</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
  <script>
    // ELEMENT REFERENCES
    const titleInput = document.getElementById("eventTitle");
    const dateInput = document.getElementById("date");
    const timeInput = document.getElementById("time");
    const locationInput = document.getElementById("location");
    const fontSelector = document.getElementById("fontSelector");
    const textColorPicker = document.getElementById("textColorPicker");
    const bgUpload = document.getElementById("bgUpload");
    const bgColorPicker = document.getElementById("bgColorPicker");
    const aiBtn = document.getElementById("aiBtn");

    const cardDesktop = document.getElementById("card-desktop");
    const cardTitleDesktop = document.getElementById("cardTitle-desktop");
    const cardDateDesktop = document.getElementById("cardDate-desktop");
    const cardTimeDesktop = document.getElementById("cardTime-desktop");
    const cardLocationDesktop = document.getElementById("cardLocation-desktop");

    const downloadBtnDesktop = document.getElementById("downloadBtnDesktop");

    let aiClickCount = 0;

    // FORMAT DATE AS DD/MM/YYYY
    function formatDateToDDMMYYYY(dateObj) {
      const dd = String(dateObj.getDate()).padStart(2, "0");
      const mm = String(dateObj.getMonth() + 1).padStart(2, "0");
      const yyyy = dateObj.getFullYear();
      return dd + "/" + mm + "/" + yyyy;
    }

    // CONVERT HSL TO HEX (FOR PASTEL GENERATION)
    function hslToHex(h, s, l) {
      s /= 100;
      l /= 100;
      const c = (1 - Math.abs(2 * l - 1)) * s;
      const x = c * (1 - Math.abs(((h / 60) % 2) - 1));
      const m = l - c / 2;
      let r = 0, g = 0, b = 0;
      if (h < 60)      { r = c; g = x; b = 0; }
      else if (h < 120){ r = x; g = c; b = 0; }
      else if (h < 180){ r = 0; g = c; b = x; }
      else if (h < 240){ r = 0; g = x; b = c; }
      else if (h < 300){ r = x; g = 0; b = c; }
      else             { r = c; g = 0; b = x; }
      const toHex = (v) => {
        const hex = Math.round((v + m) * 255).toString(16);
        return hex.length === 1 ? "0" + hex : hex;
      };
      return "#" + toHex(r) + toHex(g) + toHex(b);
    }

    // GENERATE PASTEL BACKGROUND BASED ON TITLE + SALT
    function pickPastelFromTitle(title, salt) {
      let hash = 0;
      const combo = title + "|" + salt;
      for (let i = 0; i < combo.length; i++) {
        hash = combo.charCodeAt(i) + (hash << 5) - hash;
        hash &= hash;
      }
      const hue = Math.abs(hash) % 360;
      return hslToHex(hue, 70, 85);
    }

    // PICK A RANDOM FONT BASED ON TITLE + SALT
    function pickFontFromTitle(title, salt) {
      const fonts = Array.from(fontSelector.options).map(opt => opt.value);
      let hash = 0;
      const combo = title + "|" + salt;
      for (let i = 0; i < combo.length; i++) {
        hash = combo.charCodeAt(i) + (hash << 5) - hash;
        hash &= hash;
      }
      return fonts[Math.abs(hash) % fonts.length];
    }

    // UPDATE CARD FROM INPUT FIELDS
    function updateCard() {
      // Title
      const t = titleInput.value.trim() || "Event Title";
      cardTitleDesktop.innerText = t;

      // Date
      if (dateInput.value) {
        const d = new Date(dateInput.value);
        const dateStr = "Date: " + formatDateToDDMMYYYY(d);
        cardDateDesktop.innerText = dateStr;
      } else {
        cardDateDesktop.innerText = "Date: ";
      }

      // Time
      if (timeInput.value) {
        const [h, m] = timeInput.value.split(":");
        let hh = parseInt(h, 10);
        const suffix = hh >= 12 ? "PM" : "AM";
        hh = hh % 12 || 12;
        const timeStr = `Time: ${hh}:${m} ${suffix}`;
        cardTimeDesktop.innerText = timeStr;
      } else {
        cardTimeDesktop.innerText = "Time: ";
      }

      // Location
      const loc = locationInput.value.trim() || "";
      const locStr = loc ? `Location: ${loc}` : "Location: ";
      cardLocationDesktop.innerText = locStr;

      // Font and Text Color
      cardDesktop.style.fontFamily = `"${fontSelector.value}", sans-serif`;
      cardDesktop.style.color = textColorPicker.value;

      // Background (if no image chosen)
      if (!cardDesktop.style.backgroundImage) {
        cardDesktop.style.backgroundColor = bgColorPicker.value;
      }
    }

    // HANDLE BACKGROUND IMAGE UPLOAD
    bgUpload.addEventListener("change", () => {
      const file = bgUpload.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
          cardDesktop.style.backgroundImage = `url('${e.target.result}')`;
        };
        reader.readAsDataURL(file);
      } else {
        cardDesktop.style.backgroundImage = "";
      }
    });

    // LISTEN FOR ANY INPUT/CHANGE TO UPDATE CARD
    [
      titleInput,
      dateInput,
      timeInput,
      locationInput,
      fontSelector,
      textColorPicker,
      bgColorPicker,
    ].forEach((el) => {
      el.addEventListener("input", updateCard);
      el.addEventListener("change", updateCard);
    });

    // AI BUTTON: CHOOSE PASTEL + FONT BASED ON TITLE
    aiBtn.addEventListener("click", () => {
      const title = titleInput.value.trim();
      aiClickCount++;
      const pastel = pickPastelFromTitle(title, aiClickCount);
      const font = pickFontFromTitle(title, aiClickCount);
      bgColorPicker.value = pastel;
      fontSelector.value = font;
      cardDesktop.style.backgroundImage = "";
      updateCard();
    });

    // DOWNLOAD (Desktop & Mobile Use Same Button)
    downloadBtnDesktop.addEventListener("click", () => {
      updateCard(); // ensure up to date
      html2canvas(cardDesktop, { scale: 2, backgroundColor: null }).then(
        (canvas) => {
          const link = document.createElement("a");
          link.download = "Generated by InstaCard.png";
          link.href = canvas.toDataURL("image/png");
          link.click();
        }
      );
    });

    // INITIAL SETUP ON PAGE LOAD
    document.addEventListener("DOMContentLoaded", () => {
      // Set initial background and text
      cardDesktop.style.backgroundColor = bgColorPicker.value;
      updateCard();
    });
  </script>
</body>
</html>
